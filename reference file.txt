const express = require('express'); //nope framework 
const bodyParser = require('body-parser'); //html query parser 
const path = require('path'); //relative path accessor 
const CONFIG = require('./config'); //load server configurations 
const {_} = require("underscore"); //for funtional programming 
const fs = require("fs"); //file reading and writing 

const app = express();

// serve static assets normally
app.use(express.static(__dirname + '/' + CONFIG.webDir));
app.use(express.static(__dirname + '/' + CONFIG.nodeDir));
app.use(express.static(__dirname + '/' + CONFIG.dbDir));

//convert string response to query parameter 
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));

//read JSON file  
function readJSONFile(filepath, encoding){
	
    if (typeof (encoding) == 'undefined'){
        encoding = 'utf8';
    }
    const file = fs.readFileSync(filepath, encoding);
    return JSON.parse(file);
}

//write JSON file  
function writeJSONFile(filepath, encoding){
	
    return true;
}

//get all products 
app.get('/getProducts', function(req, res){
	//read json file 
	const products = readJSONFile('./database/product_details.json');

	//send json response 
	res.setHeader('Content-Type', 'application/json');
	res.send(JSON.stringify(products));
});

//add single product
app.post('/addProduct', function(req, res){
	
	//receive params 
	const params = req.body;
	console.log(params); //print params 
	
	//logic to add product data to JSON file 
	writeJSONFile(true);
	
	//send json response 
	res.setHeader('Content-Type', 'application/json');
	res.send(JSON.stringify({ "Status": true, "Data": [{id:"11",name : "Product 1"}] }));
});

//start server 
app.listen(CONFIG.port)
console.log("server started on port " + CONFIG.port) 